<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Roguelite Demo</title>
  <style>
    body {
      margin: 0;
      background: #111;
    }
    canvas {
      display: block;
      margin: auto;
      background: #222;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="480"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const TILE_SIZE = 16;
    const MAP_WIDTH = 50;
    const MAP_HEIGHT = 30;
    const MAX_ROOMS = 8;
    const ROOM_MIN_SIZE = 5;
    const ROOM_MAX_SIZE = 10;

    let map = Array.from({ length: MAP_HEIGHT }, () =>
      Array(MAP_WIDTH).fill(1) // 1 = wall, 0 = floor
    );

    class Room {
      constructor(x, y, w, h) {
        this.x1 = x;
        this.y1 = y;
        this.x2 = x + w;
        this.y2 = y + h;
      }

      center() {
        return [
          Math.floor((this.x1 + this.x2) / 2),
          Math.floor((this.y1 + this.y2) / 2),
        ];
      }

      intersects(other) {
        return (
          this.x1 <= other.x2 &&
          this.x2 >= other.x1 &&
          this.y1 <= other.y2 &&
          this.y2 >= other.y1
        );
      }
    }

    function carveRoom(room) {
      for (let y = room.y1 + 1; y < room.y2; y++) {
        for (let x = room.x1 + 1; x < room.x2; x++) {
          map[y][x] = 0;
        }
      }
    }

    function carveTunnel(x1, y1, x2, y2) {
      if (Math.random() < 0.5) {
        carveH(x1, x2, y1);
        carveV(y1, y2, x2);
      } else {
        carveV(y1, y2, x1);
        carveH(x1, x2, y2);
      }
    }

    function carveH(x1, x2, y) {
      for (let x = Math.min(x1, x2); x <= Math.max(x1, x2); x++) {
        map[y][x] = 0;
      }
    }

    function carveV(y1, y2, x) {
      for (let y = Math.min(y1, y2); y <= Math.max(y1, y2); y++) {
        map[y][x] = 0;
      }
    }

    function generateDungeon() {
      let rooms = [];

      for (let i = 0; i < MAX_ROOMS; i++) {
        let w = ROOM_MIN_SIZE + Math.floor(Math.random() * (ROOM_MAX_SIZE - ROOM_MIN_SIZE));
        let h = ROOM_MIN_SIZE + Math.floor(Math.random() * (ROOM_MAX_SIZE - ROOM_MIN_SIZE));
        let x = Math.floor(Math.random() * (MAP_WIDTH - w - 1));
        let y = Math.floor(Math.random() * (MAP_HEIGHT - h - 1));

        let newRoom = new Room(x, y, w, h);

        if (rooms.every(r => !newRoom.intersects(r))) {
          carveRoom(newRoom);
          if (rooms.length > 0) {
            let [prevX, prevY] = rooms[rooms.length - 1].center();
            let [newX, newY] = newRoom.center();
            carveTunnel(prevX, prevY, newX, newY);
          }
          rooms.push(newRoom);
        }
      }
    }

    function drawMap() {
      for (let y = 0; y < MAP_HEIGHT; y++) {
        for (let x = 0; x < MAP_WIDTH; x++) {
          ctx.fillStyle = map[y][x] === 1 ? "#444" : "#ccc";
          ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
        }
      }
    }

    // Main execution
    generateDungeon();
    drawMap();
  </script>
</body>
</html>
